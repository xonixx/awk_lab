
@define TUSH_REPO=https://github.com/adolfopa/tush

@options timing

@goal soft_folder_created @private
@reached_if [[ -d "soft" ]]
  mkdir soft

@goal tush_installed @private
@depends_on soft_folder_created
@reached_if [[ -f "soft/tush/bin/tush-check" ]]
  echo
  echo "Fetching tush..."
  echo

  cd "soft"

  if which wget >/dev/null 2>/dev/null
  then
    wget $TUSH_REPO/archive/master.tar.gz -O./tush.tar.gz
    tar xzvf ./tush.tar.gz
    rm ./tush.tar.gz
    mv tush-master tush
  else
    git clone --depth 1 $TUSH_REPO.git
    rm -r tush/.git
  fi

@goal soft_installed @private
@depends_on tush_installed

@goal cleaned_soft @private
@reached_if [[ ! -d "soft" ]]
  rm -r "soft"

@goal cleaned @private
@depends_on cleaned_soft

@goal debug @private
  awk --version | head -n 1
  bash --version| head -n 1

@goal prepared4tests @private
@depends_on tush_installed debug

@goal @glob tests.*.tush @private
@depends_on prepared4tests
  f="$ITEM"

  export PATH="$PATH:$MYDIR/soft/tush/bin"

  if DIFF="diff --strip-trailing-cr" tush-check "$f"
  then
    echo "TESTS PASSED : $f"
  else
    echo >&2 "!!! TESTS FAILED !!! : $f"
    exit 1
  fi

@goal tested
@doc run tests
@depends_on tests.json_compile.tush
@depends_on tests.json_compile_pretty.tush
@depends_on tests.json_parser.tush
@depends_on tests.json_gron.tush
@depends_on tests.json_structure.tush
@depends_on tests.gron_parser.tush
@depends_on tests.ungron.tush
@depends_on tests.integration.tush

@goal default
@doc same as tested
@depends_on tested
